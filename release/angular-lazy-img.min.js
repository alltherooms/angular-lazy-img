angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","$rootScope","lazyImgConfig","lazyImgHelpers",function(n,t,e,r){"use strict";var o,i,a,s,c,u,l;function g(){for(var n=a.length-1;0<=n;n--){var e=a[n];e&&r.isElementInView(e.$elem[0],s.offset,o)&&(h(e),a.splice(n,1))}a.length||y()}function m(e){l.forEach(function(n){n[e]("scroll",c),n[e]("touchmove",c)}),i[e]("resize",c),i[e]("resize",u)}function f(){!0,setTimeout(function(){g(),m("on")},1)}function y(){!1,m("off")}function h(n){var e=new Image;e.onerror=function(){s.errorClass&&n.$elem.addClass(s.errorClass),n.errorSrc&&p(n.$elem,n.errorSrc),t.$apply(function(){t.$emit("lazyImg:error",n),s.onError(n)})},e.onload=function(){p(n.$elem,n.src),s.successClass&&n.$elem.addClass(s.successClass),t.$apply(function(){t.$emit("lazyImg:success",n),s.onSuccess(n)})},e.src=n.src}function p(n,e){"img"===n[0].nodeName.toLowerCase()?n[0].src=e:n.css("background-image",'url("'+e+'")')}function I(n){this.$elem=n}return a=[],!1,s=e.getOptions(),i=angular.element(n),o=r.getWinDimensions(),u=r.throttle(function(){o=r.getWinDimensions()},60),s.container=s.containers||s.container,l=s.container?[].concat(s.container):[i],c=r.throttle(g,30),I.prototype.setSource=function(n){this.src=n,a.unshift(this),f()},I.prototype.setErrorSource=function(n){this.errorSrc=n},I.prototype.removeImage=function(){var n,e;n=this,-1!==(e=a.indexOf(n))&&a.splice(e,1),a.length||y()},I.prototype.checkImages=g,I.addContainer=function(n){y(),l.push(n),f()},I.removeContainer=function(n){y(),l.splice(l.indexOf(n),1),f()},I}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var n=this.options;return{getOptions:function(){return n}}},this.setOptions=function(n){angular.extend(this.options,n)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(n){"use strict";return{isElementInView:function(n,e,t){var r=n.getBoundingClientRect();return r.left<=t.width+e&&r.right>=0-e&&r.top<=t.height+e&&r.bottom>=0-e},getWinDimensions:function(){return{height:n.innerHeight,width:n.innerWidth}},throttle:function(r,o,i){var a,s;return function(){var n=i||this,e=+new Date,t=arguments;a&&e<a+o?(clearTimeout(s),s=setTimeout(function(){a=e,r.apply(n,t)},o)):(a=e,r.apply(n,t))}}}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","$log","LazyImgMagic",function(i,n,a){"use strict";return{link:function(e,n,t){e.lazyImage=new a(n),e.lazyImage.setErrorSource(t.lazyImgError);var r=t.$observe("lazyImg",function(n){n&&e.lazyImage.setSource(n)}),o=i.$on("lazyImg:refresh",function(){e.lazyImage.checkImages()});e.$on("$destroy",function(){e.lazyImage.removeImage(),r(),o()})},restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(t){"use strict";return{link:function(n,e){t.addContainer(e),n.$on("$destroy",function(){t.removeContainer(e)})},restrict:"A"}}]);